(function(){var b,a,c,d,e;a=(function(){function f(){this.socket=io.connect("http://localhost")}f.prototype.listen=function(g,h){return this.socket.on(g,function(i){return h(i)})};f.prototype.sendSocketData=function(g,h){return this.socket.emit(g,h)};return f})();b=(function(){function f(){}f.prototype.addResultToCache=function(h,g){if(this.exists(h)){return localStorage.setItem(h,this.getHtml(h)+g)}else{return localStorage.setItem(h,g)}};f.prototype.getHtml=function(g){return this.findResult(g)};f.prototype.exists=function(g){return this.findResult(g)!=null};f.prototype.findResult=function(g){return localStorage.getItem(g)};f.prototype.keys=function(){return Object.keys(localStorage)};return f})();d=(function(){var f;function g(){this.registerTagButtons();this.getTaggedDocuments();this.socketSupport=new a();this.listenForTagAdded()}g.prototype.registerTagButtons=function(){var h=this;return $(".tag").live("click",function(i){var j;j={doi:$(i.currentTarget).attr("doi"),title:$(i.currentTarget).attr("title"),area:$(i.currentTarget).attr("area")};h.socketSupport.sendSocketData("addTaggedDocument",j);$.ajax({type:"POST",data:j,url:"/tag"});return false})};g.prototype.getTaggedDocuments=function(){var i,h;i=$("#area-id").text();h="/tag/"+i;return $.ajax({url:h,dataType:"json",type:"GET",success:function(j){return f(j)}})};f=function(i){var h;h=Mustache.to_html($("#tagged-template").html(),i);return $("#tagged-container").html(h)};g.prototype.listenForTagAdded=function(){return this.socketSupport.listen("taggedDocumentAdded",function(h){console.log("got some data added",h);return $("#tagged-container ol").append("<li><a href='http://rd.springer.com/"+h.doi+"'>"+h.title+"</a></li>")})};return g})();e=new d();c=(function(){var k,g,j,f,i;function h(){this.resultsCache=new b;this.handleSubmit();this.handleLoadMore();this.handleEmpty();k.hide()}h.prototype.doSearch=function(l){f.attr("value","Searching");this.term=j.val();if(this.resultsCache.exists(this.term)){this.renderResult(this.term);return k.show()}else{return this.getResult(this.term)}};h.prototype.getResult=function(m,n){var o,l,p=this;if(n==null){n=1}n=parseInt(n);if(n===1){o=1}else{o=n*10}l="http://api.springer.com/metadata/jsonp?q="+m+"&api_key=ueukuwx5guegu4ahjc6ajq8w&s="+o+"&callback=?";console.log(l);return $.ajax({url:l,dataType:"jsonp",type:"GET",success:function(r){var q;console.log(r);f.attr("value","Search");q=Mustache.to_html($("#template").html(),r);p.resultsCache.addResultToCache(m,q);return p.renderResult(m)}})};h.prototype.renderResult=function(l){g.html(this.resultsCache.getHtml(l));i();f.attr("value","Search");k.text("Load more");return k.show()};h.prototype.handleSubmit=function(){var l=this;return $("#search-form").submit(function(m){m.preventDefault();return l.doSearch()})};h.prototype.handleLoadMore=function(){var l=this;console.log("handing load more");return k.click(function(){var n,m;m=$("li").length-1;n=(m/10)+1;k.text("Loading more...");l.getResult(l.term,n);return false})};h.prototype.handleEmpty=function(){return $("#empty-cache").click(function(){localStorage.clear();return false})};i=function(){var l;l=g.find("ol").length;if(l>1){return g.find("li").each(function(){g.find("ol:first").append($(this));return g.find("ol").not(":first").remove()})}};k=(function(){return $("#load-more")})();f=(function(){return $("#search-button")})();g=(function(){return $("#results")})();j=(function(){return $("#search")})();return h})();$(function(){var f;return f=new c()})}).call(this);