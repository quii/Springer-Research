(function(){var c,a,d,b,j,i,h,e,g,f=function(k,l){return function(){return k.apply(l,arguments)}};h="/[^a-zA-Z\d ]/g";e=function(n,k,m){var l;l=new RegExp(m);return l.test(n)};$.validator.addMethod("regex",e,"Please check your input");g=function(k){return k.rules("add",{regex:h})};b=(function(){function k(){this.socket=io.connect(window.location.hostname)}k.prototype.listen=function(l,m){return this.socket.on(l,function(n){return m(n)})};k.prototype.sendSocketData=function(l,m){return this.socket.emit(l,m)};k.prototype.sendRecieveData=function(l,m,n){return this.socket.emit(l,m,function(o){return n(o)})};return k})();a=(function(){function k(){this.displayCurrentResearch=f(this.displayCurrentResearch,this);this.socketSupport=new b();this.currentResearch=[];this.askForRealtimeInfo();this.listenForNewAreasBeingResearched();this.tellServerImHome()}k.prototype.askForRealtimeInfo=function(){return this.socketSupport.sendRecieveData("whatsBeingResearched",{},this.displayCurrentResearch)};k.prototype.tellServerImHome=function(){return this.socketSupport.sendSocketData("whereAmI","home")};k.prototype.listenForNewAreasBeingResearched=function(){return this.socketSupport.listen("newResearchHappening",this.displayCurrentResearch)};k.prototype.displayCurrentResearch=function(o){var l,n,m,p;l=[];for(n in o){p=o[n];l.push({name:n,number:p})}if(l.length>0){this.currentResearch={results:l};m=Mustache.to_html($("#current-research-template").html(),this.currentResearch);return $("#current-research-container").html(m)}else{return $("#current-research-container").html("")}};return k})();$(function(){var k;if($("#isHome").length>0){return k=new a()}});d=(function(){function k(){}k.prototype.addResultToCache=function(m,l){if(this.exists(m)){return localStorage.setItem(m,this.getHtml(m)+l)}else{return localStorage.setItem(m,l)}};k.prototype.getHtml=function(l){return this.findResult(l)};k.prototype.exists=function(l){return this.findResult(l)!=null};k.prototype.findResult=function(l){return localStorage.getItem(l)};k.prototype.keys=function(){return Object.keys(localStorage)};return k})();c=(function(){var n,k,l,p,m,o,q;function r(){this.listenForChat=f(this.listenForChat,this);this.handleChatEntered=f(this.handleChatEntered,this);this.handleUsernameEntered=f(this.handleUsernameEntered,this);this.listenForOtherUsers=f(this.listenForOtherUsers,this);if(q){this.areaName=$("#area-id").text();this.socketSupport=new b();this.numberOfUsers=1;this.showHideChat;this.userName="";this.hideChatForm();this.listenForOtherUsers();this.handleUsernameEntered();this.handleChatEntered();this.listenForChat()}}r.prototype.listenForOtherUsers=function(){var s=this;return this.socketSupport.listen("newResearchHappening",function(t){s.numberOfUsers=t[s.areaName];s.showHideChat();o.text(s.numberOfUsers-1);return k.text(s.areaName)})};r.prototype.handleUsernameEntered=function(){var s=this;return $("#chat .alias-form").submit(function(t){t.preventDefault();if(n.val().length>0){s.userName=n.val();s.showChatForm();p.focus();return s.hideAliasForm()}})};r.prototype.handleChatEntered=function(){var s=this;return $("#chat .chat-form").submit(function(u){var t;u.preventDefault();t=p.val();p.val("");if(t.length>0){return s.sendMessage(t)}})};r.prototype.sendMessage=function(s){var t;t={user:this.userName,message:s,area:this.areaName};return this.socketSupport.sendSocketData("chatMessage",t)};r.prototype.listenForChat=function(){var s=this;return this.socketSupport.listen("recieveChat",function(t){if(t.area===s.areaName){return s.addChatLine(t.user,t.message)}})};r.prototype.addChatLine=function(s,t){return $("#chat ul").append("<li><strong>"+s+"</strong>: "+t+"</li>")};r.prototype.showHideChat=function(){if(this.numberOfUsers>1){return this.displayChat()}else{return this.hideChat()}};r.prototype.displayChat=function(){return m.show()};r.prototype.hideChat=function(){return m.hide()};r.prototype.hideChatForm=function(){return l.hide()};r.prototype.showChatForm=function(){return l.show()};r.prototype.hideAliasForm=function(){return $("#chat .alias-form").hide()};m=(function(){return $("section#chat")})();q=(function(){return m.length>0})();p=(function(){return $("#chat .text-input")})();l=(function(){return $("#chat .chat-form")})();n=(function(){return $("#chat .alias")})();o=(function(){return $("#chat .number-of-users")})();k=(function(){return $("#chat .chat-area")})();return r})();$(function(){var k;return k=new c()});i=(function(){var k;function l(){this.areaName=$("#area-id").text();this.registerTagButtons();this.getTaggedDocuments();this.socketSupport=new b();this.listenForTagAdded();this.socketSupport.sendSocketData("whereAmI",this.areaName)}l.prototype.registerTagButtons=function(){var m=this;return $(".tag").live("click",function(n){var o;o={doi:$(n.currentTarget).attr("doi"),title:$(n.currentTarget).attr("title"),area:m.areaName};console.log("tag data = ",o);m.socketSupport.sendSocketData("addTaggedDocument",o);$.ajax({type:"POST",data:o,url:"/tag"});return false})};l.prototype.getTaggedDocuments=function(){var m;m="/tag/"+this.areaName;return $.ajax({url:m,dataType:"json",type:"GET",success:function(n){return k(n)}})};k=function(n){var m;m=Mustache.to_html($("#tagged-template").html(),n);return $("#tagged-container").html(m)};l.prototype.listenForTagAdded=function(){return this.socketSupport.listen("taggedDocumentAdded",function(m){return $("#tagged-container ol").append("<li><a href='http://rd.springer.com/"+m.doi+"'>"+m.title+"</a></li>")})};return l})();$(function(){var k;if($("#tagged-container").length>0){return k=new i()}});j=(function(){var p,l,o,k,n;function m(){this.resultsCache=new d;this.handleSubmit();this.handleLoadMore();this.handleEmpty();p.hide()}m.prototype.doSearch=function(q){k.attr("value","Searching");this.term=o.val();if(this.resultsCache.exists(this.term)){this.renderResult(this.term);return p.show()}else{return this.getResult(this.term)}};m.prototype.getResult=function(r,s){var t,q,u=this;if(s==null){s=1}s=parseInt(s);if(s===1){t=1}else{t=s*10}q="http://api.springer.com/metadata/jsonp?q="+r+"&api_key=ueukuwx5guegu4ahjc6ajq8w&s="+t+"&callback=?";console.log(q);return $.ajax({url:q,dataType:"jsonp",type:"GET",success:function(w){var v;k.attr("value","Search");v=Mustache.to_html($("#template").html(),w);u.resultsCache.addResultToCache(r,v);return u.renderResult(r)}})};m.prototype.renderResult=function(q){l.html(this.resultsCache.getHtml(q));n();k.attr("value","Search");p.text("Load more");return p.show()};m.prototype.handleSubmit=function(){var q=this;return $("#search-form").submit(function(r){r.preventDefault();return q.doSearch()})};m.prototype.handleLoadMore=function(){var q=this;return p.click(function(){var s,r;r=$("li").length-1;s=(r/10)+1;p.text("Loading more...");q.getResult(q.term,s);return false})};m.prototype.handleEmpty=function(){return $("#empty-cache").click(function(){localStorage.clear();return false})};n=function(){var q;q=l.find("ol").length;if(q>1){return l.find("li").each(function(){l.find("ol:first").append($(this));return l.find("ol").not(":first").remove()})}};p=(function(){return $("#load-more")})();k=(function(){return $("#search-button")})();l=(function(){return $("#results")})();o=(function(){return $("#search")})();return m})();$(function(){var k;if($("#search").length>0){return k=new j()}})}).call(this);