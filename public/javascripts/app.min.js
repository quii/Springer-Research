(function(){var d,c,a,e,f,b=function(g,h){return function(){return g.apply(h,arguments)}};a=(function(){function g(){this.socket=io.connect("http://localhost")}g.prototype.listen=function(h,i){return this.socket.on(h,function(j){return i(j)})};g.prototype.sendSocketData=function(h,i){return this.socket.emit(h,i)};g.prototype.sendRecieveData=function(h,i,j){return this.socket.emit(h,i,function(k){return j(k)})};return g})();d=(function(){function g(){this.displayCurrentResearch=b(this.displayCurrentResearch,this);this.socketSupport=new a();this.currentResearch=[];this.askForRealtimeInfo();this.listenForNewAreasBeingResearched()}g.prototype.askForRealtimeInfo=function(){return this.socketSupport.sendRecieveData("whatsBeingResearched",{},this.displayCurrentResearch)};g.prototype.listenForNewAreasBeingResearched=function(){return this.socketSupport.listen("newResearchHappening",this.displayCurrentResearch)};g.prototype.displayCurrentResearch=function(k){var h,j,i,l;console.log("data recieved = ",k);h=[];for(j in k){l=k[j];h.push({name:j,number:l})}this.currentResearch={results:h};i=Mustache.to_html($("#current-research-template").html(),this.currentResearch);return $("#current-research-container").html(i)};return g})();$(function(){var g;if($("#isHome").length>0){return g=new d()}});c=(function(){function g(){}g.prototype.addResultToCache=function(i,h){if(this.exists(i)){return localStorage.setItem(i,this.getHtml(i)+h)}else{return localStorage.setItem(i,h)}};g.prototype.getHtml=function(h){return this.findResult(h)};g.prototype.exists=function(h){return this.findResult(h)!=null};g.prototype.findResult=function(h){return localStorage.getItem(h)};g.prototype.keys=function(){return Object.keys(localStorage)};return g})();f=(function(){var g;function h(){this.areaName=$("#area-id").text();this.registerTagButtons();this.getTaggedDocuments();this.socketSupport=new a();this.listenForTagAdded();this.tellServerImLookingAtTag()}h.prototype.registerTagButtons=function(){var i=this;return $(".tag").live("click",function(j){var k;k={doi:$(j.currentTarget).attr("doi"),title:$(j.currentTarget).attr("title"),area:$(j.currentTarget).attr("area")};i.socketSupport.sendSocketData("addTaggedDocument",k);console.log("posting tag data: "+k);$.ajax({type:"POST",data:k,url:"/tag"});return false})};h.prototype.getTaggedDocuments=function(){var i;i="/tag/"+this.areaName;console.log("trying to get from "+i);return $.ajax({url:i,dataType:"json",type:"GET",success:function(j){return g(j)}})};g=function(j){var i;i=Mustache.to_html($("#tagged-template").html(),j);return $("#tagged-container").html(i)};h.prototype.listenForTagAdded=function(){return this.socketSupport.listen("taggedDocumentAdded",function(i){return $("#tagged-container ol").append("<li><a href='http://rd.springer.com/"+i.doi+"'>"+i.title+"</a></li>")})};h.prototype.listenForWhosWhere=function(){return this.socketSupport.listen("whosWhere",function(){return this.tellServerImLookingAtTag})};h.prototype.tellServerImLookingAtTag=function(){return this.socketSupport.sendSocketData("userInArea",this.areaName)};return h})();$(function(){var g;if($("#tagged-container").length>0){return g=new f()}});e=(function(){var l,h,k,g,j;function i(){this.resultsCache=new c;this.handleSubmit();this.handleLoadMore();this.handleEmpty();l.hide()}i.prototype.doSearch=function(m){g.attr("value","Searching");this.term=k.val();if(this.resultsCache.exists(this.term)){this.renderResult(this.term);return l.show()}else{return this.getResult(this.term)}};i.prototype.getResult=function(n,o){var p,m,q=this;if(o==null){o=1}o=parseInt(o);if(o===1){p=1}else{p=o*10}m="http://api.springer.com/metadata/jsonp?q="+n+"&api_key=ueukuwx5guegu4ahjc6ajq8w&s="+p+"&callback=?";console.log(m);return $.ajax({url:m,dataType:"jsonp",type:"GET",success:function(s){var r;g.attr("value","Search");r=Mustache.to_html($("#template").html(),s);q.resultsCache.addResultToCache(n,r);return q.renderResult(n)}})};i.prototype.renderResult=function(m){h.html(this.resultsCache.getHtml(m));j();g.attr("value","Search");l.text("Load more");return l.show()};i.prototype.handleSubmit=function(){var m=this;return $("#search-form").submit(function(n){n.preventDefault();return m.doSearch()})};i.prototype.handleLoadMore=function(){var m=this;return l.click(function(){var o,n;n=$("li").length-1;o=(n/10)+1;l.text("Loading more...");m.getResult(m.term,o);return false})};i.prototype.handleEmpty=function(){return $("#empty-cache").click(function(){localStorage.clear();return false})};j=function(){var m;m=h.find("ol").length;if(m>1){return h.find("li").each(function(){h.find("ol:first").append($(this));return h.find("ol").not(":first").remove()})}};l=(function(){return $("#load-more")})();g=(function(){return $("#search-button")})();h=(function(){return $("#results")})();k=(function(){return $("#search")})();return i})();$(function(){var g;if($("#search").length>0){return g=new e()}})}).call(this);