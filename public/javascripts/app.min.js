(function(){var b,a,c,d;a=(function(){function e(){this.socket=io.connect("http://localhost")}e.prototype.listen=function(f,g){return this.socket.on(f,function(h){return g(h)})};e.prototype.sendSocketData=function(f,g){return this.socket.emit(f,g)};return e})();b=(function(){function e(){}e.prototype.addResultToCache=function(g,f){if(this.exists(g)){return localStorage.setItem(g,this.getHtml(g)+f)}else{return localStorage.setItem(g,f)}};e.prototype.getHtml=function(f){return this.findResult(f)};e.prototype.exists=function(f){return this.findResult(f)!=null};e.prototype.findResult=function(f){return localStorage.getItem(f)};e.prototype.keys=function(){return Object.keys(localStorage)};return e})();d=(function(){var e;function f(){this.areaName=$("#area-id").text();this.registerTagButtons();this.getTaggedDocuments();this.socketSupport=new a();this.listenForTagAdded()}f.prototype.registerTagButtons=function(){var g=this;return $(".tag").live("click",function(h){var i;i={doi:$(h.currentTarget).attr("doi"),title:$(h.currentTarget).attr("title"),area:$(h.currentTarget).attr("area")};g.socketSupport.sendSocketData("addTaggedDocument",i);console.log("posting tag data: "+i);$.ajax({type:"POST",data:i,url:"/tag"});return false})};f.prototype.getTaggedDocuments=function(){var g;g="/tag/"+this.areaName;console.log("trying to get from "+g);return $.ajax({url:g,dataType:"json",type:"GET",success:function(h){return e(h)}})};e=function(h){var g;g=Mustache.to_html($("#tagged-template").html(),h);return $("#tagged-container").html(g)};f.prototype.listenForTagAdded=function(){return this.socketSupport.listen("taggedDocumentAdded",function(g){return $("#tagged-container ol").append("<li><a href='http://rd.springer.com/"+g.doi+"'>"+g.title+"</a></li>")})};return f})();$(function(){var e;if($("#tagged-container").length>0){return e=new d()}});c=(function(){var j,f,i,e,h;function g(){this.resultsCache=new b;this.handleSubmit();this.handleLoadMore();this.handleEmpty();j.hide()}g.prototype.doSearch=function(k){e.attr("value","Searching");this.term=i.val();if(this.resultsCache.exists(this.term)){this.renderResult(this.term);return j.show()}else{return this.getResult(this.term)}};g.prototype.getResult=function(l,m){var n,k,o=this;if(m==null){m=1}m=parseInt(m);if(m===1){n=1}else{n=m*10}k="http://api.springer.com/metadata/jsonp?q="+l+"&api_key=ueukuwx5guegu4ahjc6ajq8w&s="+n+"&callback=?";console.log(k);return $.ajax({url:k,dataType:"jsonp",type:"GET",success:function(q){var p;e.attr("value","Search");p=Mustache.to_html($("#template").html(),q);o.resultsCache.addResultToCache(l,p);return o.renderResult(l)}})};g.prototype.renderResult=function(k){f.html(this.resultsCache.getHtml(k));h();e.attr("value","Search");j.text("Load more");return j.show()};g.prototype.handleSubmit=function(){var k=this;return $("#search-form").submit(function(l){l.preventDefault();return k.doSearch()})};g.prototype.handleLoadMore=function(){var k=this;return j.click(function(){var m,l;l=$("li").length-1;m=(l/10)+1;j.text("Loading more...");k.getResult(k.term,m);return false})};g.prototype.handleEmpty=function(){return $("#empty-cache").click(function(){localStorage.clear();return false})};h=function(){var k;k=f.find("ol").length;if(k>1){return f.find("li").each(function(){f.find("ol:first").append($(this));return f.find("ol").not(":first").remove()})}};j=(function(){return $("#load-more")})();e=(function(){return $("#search-button")})();f=(function(){return $("#results")})();i=(function(){return $("#search")})();return g})();$(function(){var e;if($("#search").length>0){return e=new c()}})}).call(this);