(function(){var g,d,c,a,e,f,b=function(h,i){return function(){return h.apply(i,arguments)}};a=(function(){function h(){this.socket=io.connect("http://localhost")}h.prototype.listen=function(i,j){return this.socket.on(i,function(k){return j(k)})};h.prototype.sendSocketData=function(i,j){return this.socket.emit(i,j)};h.prototype.sendRecieveData=function(i,j,k){return this.socket.emit(i,j,function(l){return k(l)})};return h})();d=(function(){function h(){this.displayCurrentResearch=b(this.displayCurrentResearch,this);this.socketSupport=new a();this.currentResearch=[];this.askForRealtimeInfo();this.listenForNewAreasBeingResearched();this.tellServerImHome()}h.prototype.askForRealtimeInfo=function(){return this.socketSupport.sendRecieveData("whatsBeingResearched",{},this.displayCurrentResearch)};h.prototype.tellServerImHome=function(){return this.socketSupport.sendSocketData("whereAmI","home")};h.prototype.listenForNewAreasBeingResearched=function(){return this.socketSupport.listen("newResearchHappening",this.displayCurrentResearch)};h.prototype.displayCurrentResearch=function(l){var i,k,j,m;console.log("data recieved = ",l);i=[];for(k in l){m=l[k];i.push({name:k,number:m})}this.currentResearch={results:i};j=Mustache.to_html($("#current-research-template").html(),this.currentResearch);return $("#current-research-container").html(j)};return h})();$(function(){var h;if($("#isHome").length>0){return h=new d()}});c=(function(){function h(){}h.prototype.addResultToCache=function(j,i){if(this.exists(j)){return localStorage.setItem(j,this.getHtml(j)+i)}else{return localStorage.setItem(j,i)}};h.prototype.getHtml=function(i){return this.findResult(i)};h.prototype.exists=function(i){return this.findResult(i)!=null};h.prototype.findResult=function(i){return localStorage.getItem(i)};h.prototype.keys=function(){return Object.keys(localStorage)};return h})();g=(function(){var j,h,l,i,k,m;function n(){this.listenForChat=b(this.listenForChat,this);this.handleChatEntered=b(this.handleChatEntered,this);this.handleUsernameEntered=b(this.handleUsernameEntered,this);this.listenForOtherUsers=b(this.listenForOtherUsers,this);if(m){this.areaName=$("#area-id").text();this.socketSupport=new a();this.numberOfUsers=1;this.showHideChat;this.userName="";this.disableChatInput();this.listenForOtherUsers();this.handleUsernameEntered();this.handleChatEntered();this.listenForChat()}}n.prototype.listenForOtherUsers=function(){var o=this;return this.socketSupport.listen("newResearchHappening",function(p){o.numberOfUsers=p[o.areaName];o.showHideChat();k.text(o.numberOfUsers-1);return h.text(o.areaName)})};n.prototype.handleUsernameEntered=function(){var o=this;return $("#chat .alias-form").submit(function(p){p.preventDefault();o.userName=$("#chat .alias").val();if(o.userName.length>0){o.enableChatInput();l.focus();o.hideAliasForm();return console.log("hiding form")}else{return o.disableChatInput()}})};n.prototype.handleChatEntered=function(){var o=this;return $("#chat .chat-form").submit(function(q){var p;q.preventDefault();p=$("#chat .text-input").val();if(p.length>0){o.sendMessage(p)}return $("#chat .text-input").val("")})};n.prototype.sendMessage=function(o){var p;p={user:this.userName,message:o,area:this.areaName};return this.socketSupport.sendSocketData("chatMessage",p)};n.prototype.listenForChat=function(){var o=this;return this.socketSupport.listen("recieveChat",function(p){if(p.area===o.areaName){return o.addChatLine(p.user,p.message)}})};n.prototype.addChatLine=function(o,p){return $("#chat ul").append("<li><strong>"+o+"</strong>: "+p+"</li>")};n.prototype.showHideChat=function(){if(this.numberOfUsers>1){return this.displayChat()}else{return this.hideChat()}};n.prototype.displayChat=function(){return i.show()};n.prototype.hideChat=function(){return i.hide()};n.prototype.disableChatInput=function(){return l.attr("disabled","disabled")};n.prototype.enableChatInput=function(){return l.removeAttr("disabled")};n.prototype.hideAliasForm=function(){return $("#chat .alias-form").hide()};i=(function(){return $("section#chat")})();m=(function(){return i.length>0})();l=(function(){return $("section#chat .text-input")})();j=(function(){return $("section#chat .alias")})();k=(function(){return $("#chat .number-of-users")})();h=(function(){return $("#chat .chat-area")})();return n})();$(function(){var h;return h=new g()});f=(function(){var h;function i(){this.areaName=$("#area-id").text();this.registerTagButtons();this.getTaggedDocuments();this.socketSupport=new a();this.listenForTagAdded();this.socketSupport.sendSocketData("whereAmI",this.areaName)}i.prototype.registerTagButtons=function(){var j=this;return $(".tag").live("click",function(k){var l;l={doi:$(k.currentTarget).attr("doi"),title:$(k.currentTarget).attr("title"),area:j.areaName};console.log("tag data = ",l);j.socketSupport.sendSocketData("addTaggedDocument",l);$.ajax({type:"POST",data:l,url:"/tag"});return false})};i.prototype.getTaggedDocuments=function(){var j;j="/tag/"+this.areaName;return $.ajax({url:j,dataType:"json",type:"GET",success:function(k){return h(k)}})};h=function(k){var j;j=Mustache.to_html($("#tagged-template").html(),k);return $("#tagged-container").html(j)};i.prototype.listenForTagAdded=function(){return this.socketSupport.listen("taggedDocumentAdded",function(j){return $("#tagged-container ol").append("<li><a href='http://rd.springer.com/"+j.doi+"'>"+j.title+"</a></li>")})};return i})();$(function(){var h;if($("#tagged-container").length>0){return h=new f()}});e=(function(){var m,i,l,h,k;function j(){this.resultsCache=new c;this.handleSubmit();this.handleLoadMore();this.handleEmpty();m.hide()}j.prototype.doSearch=function(n){h.attr("value","Searching");this.term=l.val();if(this.resultsCache.exists(this.term)){this.renderResult(this.term);return m.show()}else{return this.getResult(this.term)}};j.prototype.getResult=function(o,p){var q,n,r=this;if(p==null){p=1}p=parseInt(p);if(p===1){q=1}else{q=p*10}n="http://api.springer.com/metadata/jsonp?q="+o+"&api_key=ueukuwx5guegu4ahjc6ajq8w&s="+q+"&callback=?";console.log(n);return $.ajax({url:n,dataType:"jsonp",type:"GET",success:function(t){var s;h.attr("value","Search");s=Mustache.to_html($("#template").html(),t);r.resultsCache.addResultToCache(o,s);return r.renderResult(o)}})};j.prototype.renderResult=function(n){i.html(this.resultsCache.getHtml(n));k();h.attr("value","Search");m.text("Load more");return m.show()};j.prototype.handleSubmit=function(){var n=this;return $("#search-form").submit(function(o){o.preventDefault();return n.doSearch()})};j.prototype.handleLoadMore=function(){var n=this;return m.click(function(){var p,o;o=$("li").length-1;p=(o/10)+1;m.text("Loading more...");n.getResult(n.term,p);return false})};j.prototype.handleEmpty=function(){return $("#empty-cache").click(function(){localStorage.clear();return false})};k=function(){var n;n=i.find("ol").length;if(n>1){return i.find("li").each(function(){i.find("ol:first").append($(this));return i.find("ol").not(":first").remove()})}};m=(function(){return $("#load-more")})();h=(function(){return $("#search-button")})();i=(function(){return $("#results")})();l=(function(){return $("#search")})();return j})();$(function(){var h;if($("#search").length>0){return h=new e()}})}).call(this);